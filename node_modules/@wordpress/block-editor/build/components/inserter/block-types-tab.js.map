{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/block-types-tab.js"],"names":["getBlockNamespace","item","name","split","MAX_SUGGESTED_ITEMS","BlockTypesTab","rootClientId","onInsert","onHover","showMostUsedBlocks","items","categories","collections","onSelectItem","hasChildItems","select","getBlockName","blocksStore","getChildBlockNames","rootBlockName","length","suggestedItems","slice","uncategorizedItems","filter","category","itemsPerCategory","getCategoryIndex","slug","itemList","itemsPerCollection","result","Object","keys","forEach","namespace","categoryItems","title","icon","collection","collectionItems"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { map, findIndex, flow, sortBy, groupBy, orderBy } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __, _x } from '@wordpress/i18n';\nimport { store as blocksStore } from '@wordpress/blocks';\nimport { useMemo, useEffect } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport BlockTypesList from '../block-types-list';\nimport ChildBlocks from './child-blocks';\nimport InserterPanel from './panel';\nimport useBlockTypesState from './hooks/use-block-types-state';\n\nconst getBlockNamespace = ( item ) => item.name.split( '/' )[ 0 ];\n\nconst MAX_SUGGESTED_ITEMS = 6;\n\nexport function BlockTypesTab( {\n\trootClientId,\n\tonInsert,\n\tonHover,\n\tshowMostUsedBlocks,\n} ) {\n\tconst [ items, categories, collections, onSelectItem ] = useBlockTypesState(\n\t\trootClientId,\n\t\tonInsert\n\t);\n\n\tconst hasChildItems = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getBlockName } = select( 'core/block-editor' );\n\t\t\tconst { getChildBlockNames } = select( blocksStore );\n\t\t\tconst rootBlockName = getBlockName( rootClientId );\n\n\t\t\treturn !! getChildBlockNames( rootBlockName ).length;\n\t\t},\n\t\t[ rootClientId ]\n\t);\n\n\tconst suggestedItems = useMemo( () => {\n\t\treturn orderBy( items, [ 'frecency' ], [ 'desc' ] ).slice(\n\t\t\t0,\n\t\t\tMAX_SUGGESTED_ITEMS\n\t\t);\n\t}, [ items ] );\n\n\tconst uncategorizedItems = useMemo( () => {\n\t\treturn items.filter( ( item ) => ! item.category );\n\t}, [ items ] );\n\n\tconst itemsPerCategory = useMemo( () => {\n\t\tconst getCategoryIndex = ( item ) => {\n\t\t\treturn findIndex(\n\t\t\t\tcategories,\n\t\t\t\t( category ) => category.slug === item.category\n\t\t\t);\n\t\t};\n\n\t\treturn flow(\n\t\t\t( itemList ) =>\n\t\t\t\titemList.filter(\n\t\t\t\t\t( item ) => item.category && item.category !== 'reusable'\n\t\t\t\t),\n\t\t\t( itemList ) => sortBy( itemList, getCategoryIndex ),\n\t\t\t( itemList ) => groupBy( itemList, 'category' )\n\t\t)( items );\n\t}, [ items, categories ] );\n\n\tconst itemsPerCollection = useMemo( () => {\n\t\t// Create a new Object to avoid mutating collection.\n\t\tconst result = { ...collections };\n\t\tObject.keys( collections ).forEach( ( namespace ) => {\n\t\t\tresult[ namespace ] = items.filter(\n\t\t\t\t( item ) => getBlockNamespace( item ) === namespace\n\t\t\t);\n\t\t\tif ( result[ namespace ].length === 0 ) {\n\t\t\t\tdelete result[ namespace ];\n\t\t\t}\n\t\t} );\n\n\t\treturn result;\n\t}, [ items, collections ] );\n\n\t// Hide block preview on unmount.\n\tuseEffect( () => () => onHover( null ), [] );\n\n\treturn (\n\t\t<div>\n\t\t\t{ hasChildItems && (\n\t\t\t\t<ChildBlocks rootClientId={ rootClientId }>\n\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\t// Pass along every block, as useBlockTypesState() and\n\t\t\t\t\t\t// getInserterItems() will have already filtered out\n\t\t\t\t\t\t// non-child blocks.\n\t\t\t\t\t\titems={ items }\n\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\tlabel={ __( 'Child Blocks' ) }\n\t\t\t\t\t/>\n\t\t\t\t</ChildBlocks>\n\t\t\t) }\n\n\t\t\t{ showMostUsedBlocks &&\n\t\t\t\t! hasChildItems &&\n\t\t\t\t!! suggestedItems.length && (\n\t\t\t\t\t<InserterPanel title={ _x( 'Most used', 'blocks' ) }>\n\t\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\t\titems={ suggestedItems }\n\t\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\t\tlabel={ _x( 'Most used', 'blocks' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</InserterPanel>\n\t\t\t\t) }\n\n\t\t\t{ ! hasChildItems &&\n\t\t\t\tmap( categories, ( category ) => {\n\t\t\t\t\tconst categoryItems = itemsPerCategory[ category.slug ];\n\t\t\t\t\tif ( ! categoryItems || ! categoryItems.length ) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<InserterPanel\n\t\t\t\t\t\t\tkey={ category.slug }\n\t\t\t\t\t\t\ttitle={ category.title }\n\t\t\t\t\t\t\ticon={ category.icon }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\t\t\titems={ categoryItems }\n\t\t\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\t\t\tlabel={ category.title }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</InserterPanel>\n\t\t\t\t\t);\n\t\t\t\t} ) }\n\n\t\t\t{ ! hasChildItems && !! uncategorizedItems.length && (\n\t\t\t\t<InserterPanel\n\t\t\t\t\tclassName=\"block-editor-inserter__uncategorized-blocks-panel\"\n\t\t\t\t\ttitle={ __( 'Uncategorized' ) }\n\t\t\t\t>\n\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\titems={ uncategorizedItems }\n\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\tlabel={ __( 'Uncategorized' ) }\n\t\t\t\t\t/>\n\t\t\t\t</InserterPanel>\n\t\t\t) }\n\n\t\t\t{ ! hasChildItems &&\n\t\t\t\tmap( collections, ( collection, namespace ) => {\n\t\t\t\t\tconst collectionItems = itemsPerCollection[ namespace ];\n\t\t\t\t\tif ( ! collectionItems || ! collectionItems.length ) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<InserterPanel\n\t\t\t\t\t\t\tkey={ namespace }\n\t\t\t\t\t\t\ttitle={ collection.title }\n\t\t\t\t\t\t\ticon={ collection.icon }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\t\t\titems={ collectionItems }\n\t\t\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\t\t\tlabel={ collection.title }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</InserterPanel>\n\t\t\t\t\t);\n\t\t\t\t} ) }\n\t\t</div>\n\t);\n}\n\nexport default BlockTypesTab;\n"]}